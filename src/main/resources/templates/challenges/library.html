<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/default">
<th:block layout:fragment="css">
</th:block>
<th:block layout:fragment="script">
</th:block>

<div layout:fragment="content">
    <div class="container text-left" style="width: 75%; margin-bottom:5%;">
        <div class="text">
            <img th:src="@{/images/userprofile/profile-default.png}" height="200" width="200"/>
        </div>
        <div class="text-center" style="padding-right: 50%;"><span style="color: black; size: 35px;" th:text="${user.name}"></span></div>
        <div class="text-center"style="padding-right: 50%;"><span style="color: black; size: 35px;" th:text="${user.comment}"></span></div>

        <div class="text">
            <button id="reading" class="btn btn-dark" onclick="reading();">읽고 있는 책들</button>
            <button id="doneread" class="btn btn-dark" onclick="doneread();">읽은 책들</button>
        </div>
        <div class="text" style="margin-top: 50px">
            <table>
                <thead>
                <tr>
                    <th scope="col" style="width: 25%"></th>
                    <th scope="col" style="width: 25%"></th>
                    <th scope="col" style="width: 25%"></th>
                    <th scope="col" style="width: 25%"></th>
                </tr>
                </thead>
                <tbody id="challenge">

                </tbody>
            </table>

        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var userId =/*[[${user.id}]]*/ 'default';
        var chaldata;

        var d = new Date();
        var year = d.getFullYear();
        var month = d.getMonth()+1;
        var day = d.getDate();

        $(document).ready(function() {
            var bookStatus = '읽는중';
            $.ajax({
                type: 'get',
                url: '/api/challenge?userId=' + userId,
                async: false,
                contentType: "application/json",
                error: function () {
                    alert('와!에러!와!일해라!');
                },
                success: function (data) {
                    $('#challenge').html("");
                    chaldata = data;
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].bookStatus == '읽는중') {
                            var challengeDiv = $(' <tr data-toggle="collapse" data-target="#book' + data[i].id +'" class="clickable" border-bottom: 1px solid black;"><td><span style="padding-right: 150px;"><img style="margin-top: 50px; margin-bottom: 10px; width: 100px;" src="' + data[i].thumbnailImage + '" /></span></td>\n' +
                                '                    <td><span style="padding-right: 150px;">'  + data[i].booksTitle + '</span></td>\n' +
                                '                    <td><span style="padding-right: 150px;">' + data[i].startDate + '</span></td>\n' +
                                '                    <td><span style="padding-right: 150px;">' + data[i].endDate + '</span></td></tr>' +
                                '                    <tr><td colspan="3"><div id="book'+data[i].id+'" class="collapse"> <textarea type="text" class="form-control" rows="5" name="review" id="review" placeholder="30자 이상을 남겨주세요"\n' +
                                '                                   title="review"></textarea><button type="submit" style="margin-top: 15px" class="btn btn-dark topBtn"> 작성</button></div></td></tr>');
                            challengeDiv.appendTo($('#challenge'));
                        }
                    }
                }
            });
            $("#demo").on("hide.bs.collapse", function(){
                $(".btn").html('<span class="glyphicon glyphicon-collapse-down"></span> Open');
            });
            $("#demo").on("show.bs.collapse", function(){
                $(".btn").html('<span class="glyphicon glyphicon-collapse-up"></span> Close');
            });
        });
        function doneread() {
            $('#challenge').html("");
            document.getElementById("doneread").style.backgroundColor = "cornflowerblue";
            document.getElementById("reading").style.backgroundColor = "";
            var comp = '완료';
            console.log(chaldata);
            for (var i = 0; i < chaldata.length; i++) {
                if (chaldata[i].bookStatus == '완료') {
                    console.log(chaldata[i]);
                    var challengeDiv = $(' <tr border-bottom: 1px solid black;"><td><span style="padding-right: 150px;"><img style="margin-bottom: 50px; width: 100px;" src="' + chaldata[i].thumbnailImage + '" /></span></td>\n' +
                        '                    <td><span style="padding-right: 150px;">'  + chaldata[i].booksTitle + '</span></td>\n' +
                        '                    <td><span style="padding-right: 150px;">' + chaldata[i].startDate + '</span></td>\n' +
                        '                    <td><span style="padding-right: 150px;">' + chaldata[i].endDate + '</span></td></tr>');
                    challengeDiv.appendTo($('#challenge'));
                }

            }
        }

        function reading() {
            $('#challenge').html("");
            document.getElementById("doneread").style.backgroundColor = "";
            document.getElementById("reading").style.backgroundColor = "cornflowerblue";
            var comp = '완료';
            console.log(chaldata);
            for (var i = 0; i < chaldata.length; i++) {
                if (chaldata[i].bookStatus == '읽는중') {
                    var challengeDiv = $(' <tr data-toggle="collapse" data-target="#book' + chaldata[i].id +'" class="clickable" border-bottom: 1px solid black;"><td><span style="padding-right: 150px;"><img style="margin-top: 50px; margin-bottom: 10px; width: 100px;" src="' + chaldata[i].thumbnailImage + '" /></span></td>\n' +
                        '                    <td><span style="padding-right: 150px;">'  + chaldata[i].booksTitle + '</span></td>\n' +
                        '                    <td><span style="padding-right: 150px;">' + chaldata[i].startDate + '</span></td>\n' +
                        '                    <td><span style="padding-right: 150px;">' + chaldata[i].endDate + '</span></td></tr>' +
                        '                    <tr><td colspan="3"><div id="book'+chaldata[i].id+'" class="collapse"> <input type="text" class="form-control" name="review" id="review" placeholder="30자 이상을 남겨주세요"\n' +
                        '                                   title="review"><button type="submit" class="btn btn-dark topBtn"> 작성</button></div></td></tr>');
                    challengeDiv.appendTo($('#challenge'));
                }
            }
        }

        /*]]>*/
    </script>
</div>
</html>